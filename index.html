<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Динозаврик Chrome</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: manipulation;
            -webkit-user-select: none;
            user-select: none;
        }

        body {
            background-color: #000;
            font-family: 'Arial', sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            padding: 0;
            margin: 0;
        }

        .fullscreen-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: #fff;
            z-index: 1;
        }

        #gameCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: #fff;
            display: block;
            cursor: pointer;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }

        .mobile-controls {
            position: fixed;
            bottom: 30px;
            left: 0;
            width: 100vw;
            display: flex;
            justify-content: center;
            z-index: 100;
            display: none;
        }

        .jump-btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 50px;
            width: 120px;
            height: 120px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.4);
            transition: all 0.1s;
            touch-action: manipulation;
            position: relative;
            overflow: hidden;
        }

        .jump-btn:active {
            transform: scale(0.95);
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
        }

        .jump-btn::after {
            content: '↑';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 40px;
        }

        .game-over {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.95);
            color: white;
            padding: 60px 80px;
            border-radius: 20px;
            text-align: center;
            display: none;
            z-index: 1000;
            box-shadow: 0 0 80px rgba(255, 0, 0, 0.5);
            border: 4px solid #ff4444;
            min-width: 400px;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(10px);
        }

        .game-over h2 {
            font-size: 48px;
            margin-bottom: 30px;
            color: #ff4444;
            text-shadow: 0 0 20px rgba(255, 68, 68, 0.7);
            letter-spacing: 2px;
        }

        .game-over p {
            font-size: 36px;
            margin-bottom: 40px;
            color: #fff;
            font-weight: bold;
        }

        .game-over button {
            padding: 20px 40px;
            font-size: 24px;
            background-color: #2196F3;
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            min-width: 250px;
            box-shadow: 0 6px 20px rgba(33, 150, 243, 0.4);
        }

        .game-over button:hover {
            background-color: #0b7dda;
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(33, 150, 243, 0.5);
        }

        .game-over button:active {
            transform: translateY(1px);
        }

        .score-display {
            position: fixed;
            top: 30px;
            left: 30px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 15px 25px;
            border-radius: 12px;
            font-size: 28px;
            font-weight: bold;
            z-index: 10;
            display: flex;
            gap: 20px;
            min-width: 300px;
            backdrop-filter: blur(5px);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .score-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .score-label {
            font-size: 14px;
            color: #aaa;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .score-value {
            font-size: 32px;
            color: #fff;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        #score {
            color: #4CAF50;
        }

        #highScore {
            color: #2196F3;
        }

        #fps {
            color: #FF9800;
        }

        .start-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.9);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            text-align: center;
            padding: 20px;
        }

        .start-screen h1 {
            font-size: 48px;
            margin-bottom: 20px;
            color: #4CAF50;
            text-shadow: 0 0 20px rgba(76, 175, 80, 0.7);
        }

        .start-screen p {
            font-size: 24px;
            margin-bottom: 40px;
            max-width: 600px;
            line-height: 1.5;
        }

        .start-screen .controls-info {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            font-size: 18px;
        }

        .key {
            display: inline-block;
            background-color: #333;
            color: white;
            padding: 5px 15px;
            border-radius: 5px;
            margin: 0 5px;
            font-family: monospace;
            font-size: 16px;
        }

        .start-screen button {
            padding: 20px 50px;
            font-size: 24px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.4);
            transition: all 0.3s;
        }

        .start-screen button:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 30px rgba(76, 175, 80, 0.6);
        }

        /* Для очень больших экранов */
        @media (min-width: 1920px) {
            .game-over {
                padding: 80px 100px;
                min-width: 500px;
                min-height: 400px;
            }
            
            .game-over h2 {
                font-size: 56px;
            }
            
            .game-over p {
                font-size: 44px;
            }
            
            .game-over button {
                padding: 25px 50px;
                font-size: 28px;
                min-width: 300px;
            }
            
            .score-display {
                padding: 20px 35px;
                font-size: 32px;
                min-width: 400px;
            }
            
            .score-value {
                font-size: 40px;
            }
            
            .score-label {
                font-size: 16px;
            }
            
            .mobile-controls {
                bottom: 50px;
            }
            
            .jump-btn {
                width: 150px;
                height: 150px;
                font-size: 24px;
            }
        }

        /* Для мобильных устройств */
        @media (max-width: 768px) {
            .mobile-controls {
                display: flex;
            }
            
            .start-screen {
                display: none;
            }
            
            .game-over {
                padding: 40px 30px;
                min-width: 90%;
                min-height: auto;
                border-radius: 15px;
            }
            
            .game-over h2 {
                font-size: 36px;
                margin-bottom: 20px;
            }
            
            .game-over p {
                font-size: 28px;
                margin-bottom: 30px;
            }
            
            .game-over button {
                padding: 15px 30px;
                font-size: 20px;
                min-width: 200px;
            }
            
            .score-display {
                top: 20px;
                left: 20px;
                padding: 12px 20px;
                min-width: 250px;
                font-size: 22px;
                flex-direction: column;
                gap: 10px;
            }
            
            .score-value {
                font-size: 26px;
            }
            
            .jump-btn {
                width: 100px;
                height: 100px;
            }
            
            .jump-btn::after {
                font-size: 30px;
            }
        }

        /* Для очень маленьких экранов */
        @media (max-width: 480px) {
            .score-display {
                min-width: 200px;
                padding: 10px 15px;
                font-size: 18px;
                top: 10px;
                left: 10px;
            }
            
            .score-value {
                font-size: 22px;
            }
            
            .score-label {
                font-size: 12px;
            }
            
            .game-over {
                padding: 30px 20px;
            }
            
            .game-over h2 {
                font-size: 30px;
            }
            
            .game-over p {
                font-size: 24px;
            }
            
            .jump-btn {
                width: 90px;
                height: 90px;
            }
        }

        /* Анимация для счета */
        @keyframes scorePop {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .score-pop {
            animation: scorePop 0.3s ease;
        }

        /* Анимация для нового рекорда */
        @keyframes newRecord {
            0% { color: #2196F3; }
            50% { color: #FFD700; text-shadow: 0 0 20px rgba(255, 215, 0, 0.8); }
            100% { color: #2196F3; }
        }

        .new-record {
            animation: newRecord 1s ease 3;
        }
    </style>
</head>
<body>
    <div class="fullscreen-container">
        <canvas id="gameCanvas"></canvas>
        
        <div class="score-display">
            <div class="score-item">
                <div class="score-label">СЧЕТ</div>
                <div id="score" class="score-value">0</div>
            </div>
            <div class="score-item">
                <div class="score-label">РЕКОРД</div>
                <div id="highScore" class="score-value">0</div>
            </div>
            <div class="score-item">
                <div class="score-label">FPS</div>
                <div id="fps" class="score-value">60</div>
            </div>
        </div>
        
        <div class="mobile-controls">
            <button class="jump-btn"></button>
        </div>
        
        <div id="gameOver" class="game-over">
            <h2>ИГРА ОКОНЧЕНА</h2>
            <p>Ваш счет: <span id="finalScore">0</span></p>
            <button id="restartBtn">ИГРАТЬ СНОВА</button>
        </div>
        
        <div id="startScreen" class="start-screen">
            <h1>ДИНОЗАВРИК CHROME</h1>
            <p>Используйте вашу картинку вместо динозаврика</p>
            <div class="controls-info">
                <p><span class="key">ПРОБЕЛ</span> или <span class="key">↑</span> - Прыжок</p>
                <p><span class="key">↓</span> - Присесть</p>
                <p>Избегайте кактусов!</p>
            </div>
            <button id="startBtn">НАЧАТЬ ИГРУ</button>
        </div>
    </div>

    <script>
        // ========== КОНСТАНТЫ И НАСТРОЙКИ ==========
        const GAME = {
            playerWidth: 80,      // Увеличено для 1920x1080
            playerHeight: 80,     // Увеличено для 1920x1080
            playerJumpForce: 16,  // Увеличено для более высокого прыжка
            gravity: 0.8,
            initialSpeed: 8,
            speedIncrease: 0.0005,
            cactusWidth: 30,      // Увеличено
            minCactusHeight: 50,  // Увеличено
            maxCactusHeight: 80,  // Увеличено
            minCactusGap: 300,
            maxCactusGap: 500,
            groundHeight: 20      // Увеличено
        };

        // ========== ПЕРЕМЕННЫЕ ИГРЫ ==========
        let canvas, ctx;
        let gameRunning = false;
        let gameSpeed = GAME.initialSpeed;
        let score = 0;
        let highScore = localStorage.getItem('dinoHighScore') || 0;
        let frames = 0;
        let fps = 60;
        let lastTime = 0;
        let fpsInterval = 1000/60;
        let then = Date.now();
        let gameLoopId = null;
        let isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        
        // ========== ИГРОВЫЕ ОБЪЕКТЫ ==========
        let player = {
            x: 150, // Отодвинуто от края
            y: 0,
            width: GAME.playerWidth,
            height: GAME.playerHeight,
            velocityY: 0,
            isJumping: false,
            isDucking: false,
            duckHeight: GAME.playerHeight * 0.6,
            groundY: 0 // Будет установлено позже
        };
        
        let obstacles = [];
        let clouds = [];
        
        // ========== ИЗОБРАЖЕНИЯ ==========
        let playerImg = new Image();
        let cactusImg = new Image();
        
        // ========== DOM ЭЛЕМЕНТЫ ==========
        let scoreElement, highScoreElement, fpsElement;
        let startBtn, jumpBtn, restartBtn;
        let gameOverScreen, finalScoreElement;
        let startScreen;
        let canvasContainer;

        // ========== ИНИЦИАЛИЗАЦИЯ ИГРЫ ==========
        function init() {
            console.log("Инициализация игры...");
            
            // Получаем элементы DOM
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');
            
            scoreElement = document.getElementById('score');
            highScoreElement = document.getElementById('highScore');
            fpsElement = document.getElementById('fps');
            startBtn = document.getElementById('startBtn');
            jumpBtn = document.querySelector('.jump-btn');
            restartBtn = document.getElementById('restartBtn');
            gameOverScreen = document.getElementById('gameOver');
            finalScoreElement = document.getElementById('finalScore');
            startScreen = document.getElementById('startScreen');
            
            // Настраиваем канвас на полный экран
            resizeCanvas();
            
            // Устанавливаем позицию земли
            player.groundY = canvas.height - GAME.groundHeight - player.height;
            player.y = player.groundY;
            
            // Загружаем картинку игрока
            playerImg.src = 'images/othcim.jpg';
            playerImg.onerror = function() {
                console.log("Изображение не найдено. Создаю стандартного динозаврика...");
                createDefaultPlayerImage();
            };
            
            // Создаем изображения
            createCactusImage();
            createClouds();
            
            // Устанавливаем начальные значения
            highScoreElement.textContent = formatNumber(highScore);
            
            // Настраиваем мобильное управление
            if (isMobile) {
                document.querySelector('.mobile-controls').style.display = 'flex';
                startScreen.style.display = 'none';
            }
            
            // Назначаем обработчики событий
            setupEventListeners();
            
            // Запускаем игровой цикл
            then = Date.now();
            gameLoop();
            
            console.log("Игра инициализирована");
        }

        // ========== РАЗМЕР КАНВАСА ==========
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            // Обновляем позицию земли при изменении размера
            if (player) {
                player.groundY = canvas.height - GAME.groundHeight - player.height;
                if (!player.isJumping) {
                    player.y = player.groundY;
                }
            }
            
            console.log(`Размер канваса: ${canvas.width}x${canvas.height}`);
        }

        // ========== СОЗДАНИЕ ИЗОБРАЖЕНИЙ ==========
        function createDefaultPlayerImage() {
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = GAME.playerWidth;
            tempCanvas.height = GAME.playerHeight;
            const tempCtx = tempCanvas.getContext('2d');
            
            // Большой динозаврик для 1920x1080
            tempCtx.fillStyle = '#535353';
            
            // Тело (больше)
            tempCtx.fillRect(15, 20, 50, 40);
            
            // Ноги (толще)
            tempCtx.fillRect(20, 60, 12, 20);
            tempCtx.fillRect(48, 60, 12, 20);
            
            // Голова и шея (больше)
            tempCtx.fillRect(60, 10, 16, 30);
            tempCtx.fillRect(70, 4, 20, 20);
            
            // Глаз (больше)
            tempCtx.fillStyle = 'white';
            tempCtx.fillRect(76, 8, 8, 8);
            tempCtx.fillStyle = 'black';
            tempCtx.fillRect(78, 10, 4, 4);
            
            // Хвост (больше)
            tempCtx.fillStyle = '#535353';
            tempCtx.fillRect(0, 30, 10, 8);
            tempCtx.fillRect(4, 38, 6, 4);
            
            playerImg.src = tempCanvas.toDataURL();
        }

        function createCactusImage() {
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = GAME.cactusWidth;
            tempCanvas.height = GAME.maxCactusHeight;
            const tempCtx = tempCanvas.getContext('2d');
            
            // Большой кактус
            tempCtx.fillStyle = '#0a0';
            tempCtx.fillRect(8, 0, 14, GAME.maxCactusHeight);
            
            // Полоски на кактусе
            tempCtx.fillStyle = '#080';
            tempCtx.fillRect(10, 10, 10, 6);
            tempCtx.fillRect(10, 30, 10, 6);
            tempCtx.fillRect(10, 50, 10, 6);
            
            // Шипы (больше)
            tempCtx.strokeStyle = '#060';
            tempCtx.lineWidth = 2;
            
            // Левые шипы
            tempCtx.beginPath();
            tempCtx.moveTo(8, 20);
            tempCtx.lineTo(2, 20);
            tempCtx.stroke();
            
            tempCtx.beginPath();
            tempCtx.moveTo(8, 40);
            tempCtx.lineTo(2, 40);
            tempCtx.stroke();
            
            tempCtx.beginPath();
            tempCtx.moveTo(8, 60);
            tempCtx.lineTo(2, 60);
            tempCtx.stroke();
            
            // Правые шипы
            tempCtx.beginPath();
            tempCtx.moveTo(22, 30);
            tempCtx.lineTo(28, 30);
            tempCtx.stroke();
            
            tempCtx.beginPath();
            tempCtx.moveTo(22, 50);
            tempCtx.lineTo(28, 50);
            tempCtx.stroke();
            
            tempCtx.beginPath();
            tempCtx.moveTo(22, 70);
            tempCtx.lineTo(28, 70);
            tempCtx.stroke();
            
            cactusImg.src = tempCanvas.toDataURL();
        }

        function createClouds() {
            clouds = [];
            for (let i = 0; i < 4; i++) {
                clouds.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * 150 + 50,
                    width: Math.random() * 60 + 80,
                    speed: Math.random() * 0.8 + 0.3
                });
            }
        }

        // ========== ОСНОВНЫЕ ФУНКЦИИ ИГРЫ ==========
        function startGame() {
            if (gameRunning) return;
            
            resetGame();
            gameRunning = true;
            gameOverScreen.style.display = 'none';
            startScreen.style.display = 'none';
            
            console.log("Игра началась");
        }

        function resetGame() {
            score = 0;
            gameSpeed = GAME.initialSpeed;
            obstacles = [];
            frames = 0;
            
            player.y = player.groundY;
            player.velocityY = 0;
            player.isJumping = false;
            player.isDucking = false;
            player.height = GAME.playerHeight;
            
            updateScore();
        }

        function gameOver() {
            gameRunning = false;
            gameOverScreen.style.display = 'flex';
            
            // Обновляем рекорд
            if (score > highScore) {
                highScore = score;
                highScoreElement.textContent = formatNumber(highScore);
                localStorage.setItem('dinoHighScore', highScore);
                highScoreElement.classList.add('new-record');
                setTimeout(() => {
                    highScoreElement.classList.remove('new-record');
                }, 1000);
            }
            
            // Показываем итоговый счет
            finalScoreElement.textContent = formatNumber(score);
            
            console.log("Игра окончена. Счет:", score);
        }

        // ========== ОБНОВЛЕНИЕ ИГРОВОГО СОСТОЯНИЯ ==========
        function update(currentTime) {
            if (!gameRunning) return;
            
            frames++;
            
            // Рассчитываем FPS
            const now = Date.now();
            const elapsed = now - then;
            
            if (elapsed > fpsInterval) {
                then = now - (elapsed % fpsInterval);
                fps = Math.round(1000 / elapsed);
                fpsElement.textContent = fps;
            }
            
            // Увеличиваем скорость со временем
            gameSpeed += GAME.speedIncrease;
            
            // Обновляем игрока
            updatePlayer();
            
            // Обновляем препятствия
            updateObstacles();
            
            // Обновляем облака
            updateClouds();
            
            // Увеличиваем счет
            score += Math.round(gameSpeed);
            if (frames % 10 === 0) {
                updateScore();
            }
            
            // Проверяем столкновения
            checkCollisions();
        }

        function updatePlayer() {
            // Применяем гравитацию
            if (player.isJumping) {
                player.velocityY -= GAME.gravity;
                player.y -= player.velocityY;
                
                // Проверяем, достиг ли игрок земли
                if (player.y >= player.groundY) {
                    player.y = player.groundY;
                    player.isJumping = false;
                    player.velocityY = 0;
                }
            }
        }

        function updateObstacles() {
            // Удаляем препятствия, которые ушли за экран
            obstacles = obstacles.filter(obstacle => obstacle.x + obstacle.width > 0);
            
            // Двигаем препятствия
            for (let obstacle of obstacles) {
                obstacle.x -= gameSpeed;
                
                // Отмечаем пройденные препятствия
                if (!obstacle.passed && obstacle.x + obstacle.width < player.x) {
                    obstacle.passed = true;
                    score += 100;
                    scoreElement.classList.add('score-pop');
                    setTimeout(() => {
                        scoreElement.classList.remove('score-pop');
                    }, 300);
                }
            }
            
            // Создаем новые препятствия
            if (frames % Math.floor((GAME.maxCactusGap) / gameSpeed) === 0) {
                createObstacle();
            }
        }

        function createObstacle() {
            const height = Math.floor(Math.random() * 
                (GAME.maxCactusHeight - GAME.minCactusHeight)) + 
                GAME.minCactusHeight;
            
            obstacles.push({
                x: canvas.width,
                y: canvas.height - GAME.groundHeight - height,
                width: GAME.cactusWidth,
                height: height,
                passed: false
            });
        }

        function updateClouds() {
            for (let cloud of clouds) {
                cloud.x -= cloud.speed;
                
                // Если облако ушло за экран, перемещаем его в начало
                if (cloud.x + cloud.width < 0) {
                    cloud.x = canvas.width;
                    cloud.y = Math.random() * 150 + 50;
                }
            }
        }

        function checkCollisions() {
            for (let obstacle of obstacles) {
                if (checkCollision(player, obstacle)) {
                    gameOver();
                    return;
                }
            }
        }

        function checkCollision(rect1, rect2) {
            return rect1.x < rect2.x + rect2.width &&
                   rect1.x + rect1.width > rect2.x &&
                   rect1.y < rect2.y + rect2.height &&
                   rect1.y + rect1.height > rect2.y;
        }

        // ========== УПРАВЛЕНИЕ ==========
        function jump() {
            if (!gameRunning) {
                startGame();
                return;
            }
            
            if (!player.isJumping) {
                player.isJumping = true;
                player.velocityY = GAME.playerJumpForce;
                player.isDucking = false;
                player.height = GAME.playerHeight;
                
                // Эффект нажатия на мобильном
                if (isMobile) {
                    jumpBtn.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        jumpBtn.style.transform = 'scale(1)';
                    }, 100);
                }
            }
        }

        function duck(startDucking) {
            if (!gameRunning || player.isJumping) return;
            
            player.isDucking = startDucking;
            player.height = startDucking ? player.duckHeight : GAME.playerHeight;
            player.y = startDucking ? player.groundY + (GAME.playerHeight - player.duckHeight) : player.groundY;
        }

        // ========== ОТРИСОВКА ==========
        function draw() {
            // Очищаем канвас
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Рисуем фон (небо)
            ctx.fillStyle = '#f7f7f7';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Рисуем облака
            drawClouds();
            
            // Рисуем землю
            drawGround();
            
            // Рисуем препятствия
            drawObstacles();
            
            // Рисуем игрока
            drawPlayer();
            
            // Если игра не запущена и нет экрана game over, рисуем стартовый экран
            if (!gameRunning && gameOverScreen.style.display === 'none' && !isMobile) {
                startScreen.style.display = 'flex';
            }
        }

        function drawGround() {
            // Земля
            ctx.fillStyle = '#535353';
            ctx.fillRect(0, canvas.height - GAME.groundHeight, canvas.width, GAME.groundHeight);
            
            // Линия горизонта
            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(0, canvas.height - GAME.groundHeight);
            ctx.lineTo(canvas.width, canvas.height - GAME.groundHeight);
            ctx.stroke();
            
            // Текстура земли
            ctx.fillStyle = '#666';
            for (let i = 0; i < canvas.width; i += 40) {
                ctx.fillRect(i, canvas.height - GAME.groundHeight, 4, 6);
            }
        }

        function drawClouds() {
            for (let cloud of clouds) {
                ctx.fillStyle = '#f0f0f0';
                
                // Рисуем большое пушистое облако
                ctx.beginPath();
                ctx.arc(cloud.x + 20, cloud.y, 16, 0, Math.PI * 2);
                ctx.arc(cloud.x + 40, cloud.y - 10, 20, 0, Math.PI * 2);
                ctx.arc(cloud.x + 60, cloud.y, 16, 0, Math.PI * 2);
                ctx.arc(cloud.x + 40, cloud.y + 10, 14, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function drawPlayer() {
            // Рисуем картинку игрока (большую)
            ctx.drawImage(playerImg, player.x, player.y, player.width, player.height);
            
            // Если игрок пригнулся
            if (player.isDucking) {
                ctx.fillStyle = '#535353';
                ctx.fillRect(player.x + 10, player.y + player.height - 10, player.width - 20, 6);
            }
        }

        function drawObstacles() {
            for (let obstacle of obstacles) {
                // Рисуем кактус
                ctx.drawImage(cactusImg, 0, cactusImg.height - obstacle.height, 
                    obstacle.width, obstacle.height,
                    obstacle.x, obstacle.y, 
                    obstacle.width, obstacle.height);
                
                // Тень под кактусом
                ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
                ctx.fillRect(
                    obstacle.x + 4, 
                    canvas.height - GAME.groundHeight, 
                    obstacle.width - 8, 
                    6
                );
            }
        }

        // ========== ВСПОМОГАТЕЛЬНЫЕ ФУНКЦИИ ==========
        function updateScore() {
            scoreElement.textContent = formatNumber(score);
        }

        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }

        // ========== ОБРАБОТЧИКИ СОБЫТИЙ ==========
        function setupEventListeners() {
            // Клавиатура
            document.addEventListener('keydown', handleKeyDown);
            document.addEventListener('keyup', handleKeyUp);
            
            // Кнопки
            startBtn.addEventListener('click', startGame);
            jumpBtn.addEventListener('click', jump);
            restartBtn.addEventListener('click', startGame);
            
            // Клик по канвасу
            canvas.addEventListener('click', () => {
                if (!gameRunning && !isMobile) {
                    startGame();
                }
            });
            
            // Касания для мобильных
            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                if (!gameRunning) {
                    startGame();
                } else {
                    jump();
                }
            });
            
            // Изменение размера окна
            window.addEventListener('resize', resizeCanvas);
            
            // Предотвращаем контекстное меню
            canvas.addEventListener('contextmenu', (e) => e.preventDefault());
            
            // Обработка отпускания кнопки на мобильном
            jumpBtn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                jump();
            });
            
            jumpBtn.addEventListener('touchend', (e) => {
                e.preventDefault();
                jumpBtn.style.transform = 'scale(1)';
            });
        }

        function handleKeyDown(e) {
            switch(e.code) {
                case 'Space':
                    e.preventDefault();
                    jump();
                    break;
                case 'ArrowUp':
                    e.preventDefault();
                    jump();
                    break;
                case 'ArrowDown':
                    e.preventDefault();
                    duck(true);
                    break;
            }
        }

        function handleKeyUp(e) {
            if (e.code === 'ArrowDown') {
                duck(false);
            }
        }

        // ========== ИГРОВОЙ ЦИКЛ ==========
        function gameLoop(currentTime = 0) {
            update(currentTime);
            draw();
            gameLoopId = requestAnimationFrame(gameLoop);
        }

        // ========== ЗАПУСК ИГРЫ ==========
        // Ждем загрузки изображений
        let imagesLoaded = 0;
        const totalImages = 2;
        
        function checkAllImagesLoaded() {
            imagesLoaded++;
            if (imagesLoaded === totalImages) {
                setTimeout(init, 100);
            }
        }
        
        playerImg.onload = checkAllImagesLoaded;
        cactusImg.onload = checkAllImagesLoaded;
        playerImg.onerror = checkAllImagesLoaded;
        
        // Инициализация при загрузке страницы
        window.addEventListener('load', () => {
            if (playerImg.complete && cactusImg.complete) {
                setTimeout(init, 100);
            }
        });
        
        // Запасной таймаут
        setTimeout(() => {
            if (!gameLoopId) {
                console.log("Принудительная инициализация...");
                init();
            }
        }, 3000);
    </script>
</body>
</html>
